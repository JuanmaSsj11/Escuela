<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ordena las palabras</title>
<link rel="stylesheet" href="estilos.css">
<style>
/* Parpadeos suaves */
body.parpadeo-correcto {
  animation: flash-verde 0.5s;
}
body.parpadeo-error {
  animation: flash-rojo 0.5s;
}
@keyframes flash-verde {
  0% { background-color: rgba(0, 255, 0, 0.2); }
  100% { background-color: transparent; }
}
@keyframes flash-rojo {
  0% { background-color: rgba(255, 0, 0, 0.2); }
  100% { background-color: transparent; }
}
</style>
</head>
<body>

<header>
    <button id="btnRegresar" class="btn-regresar">‚¨Ö Regresar</button>
    <h1>Visualiza, Lee y Ordena</h1>
    <p class="autores">Autor: Mtro. Felipe Cruz Suastegi - Jefe del Sector IV Educaci√≥n Primaria<br>
    Co-autor: Juan Manuel Ontiveros Dom√≠nguez</p>
</header>

<!-- Audios -->
<audio id="audio-error" src="audios/error.mp3"></audio>
<audio id="audio-correcto" src="audios/correcto.mp3"></audio>
<audio id="audio-yeh" src="audios/yeh.mp3"></audio>

<div class="juego2">
    <div id="imagenFrase"></div>
    <div id="fraseSeleccionada"></div>
    <div id="palabras"></div>
    <button id="verificar">Verificar</button>
</div>

<div id="mensaje"></div>

<script>
const datos = [
    {img:"elefante.png",  frase: ["El elefante vive en √Åfrica"]},
    {img:"nino_tina.png", frase: ["√Ångel se ba√±a en la tina"]},
    {img:"olla.png",      frase: ["La olla de √ìscar es de barro"]},
    {img:"sapo.png",      frase: ["El sapo salta sin cansarse"]},
    {img:"bailarina.png", frase: ["Rosa baila rumba y cumbia","Rosa baila cumbia y rumba"]}
];

let fraseActualIndex = 0;
let seleccionadas = [];

// üéµ Audios
const audioError = document.getElementById("audio-error");
const audioCorrecto = document.getElementById("audio-correcto");
const audioYeh = document.getElementById("audio-yeh");

function iniciarJuego() {
    seleccionadas = [];
    document.getElementById("palabras").innerHTML = "";
    document.getElementById("fraseSeleccionada").textContent = "";

    let datosActuales = datos[fraseActualIndex];

    // Imagen arriba
    let imagenDiv = document.getElementById("imagenFrase");
    imagenDiv.innerHTML = `<img src="imagenes/${datosActuales.img}" alt="Imagen frase" class="imagenFrase">`;

    // Indicador
    document.getElementById("fraseSeleccionada").textContent = "Selecciona las palabras en orden:";

    // Palabras desordenadas desde la primera variante
    let palabras = datosActuales.frase[0].split(" ");
    let palabrasDesordenadas = [...palabras].sort(()=>Math.random()-0.5);

    palabrasDesordenadas.forEach(palabra=>{
        let btn = document.createElement("button");
        btn.className = "palabra";
        btn.textContent = palabra;
        btn.dataset.seleccionada = "false";

        btn.addEventListener("click", () => {
            if(btn.classList.contains("seleccionada")){
                btn.classList.remove("seleccionada");
                seleccionadas = seleccionadas.filter(p => p !== palabra);
            } else {
                btn.classList.add("seleccionada");
                seleccionadas.push(palabra);
            }
            actualizarFraseSeleccionada();
        });

        document.getElementById("palabras").appendChild(btn);
    });
}

function actualizarFraseSeleccionada(){
    document.getElementById("fraseSeleccionada").textContent = seleccionadas.join(" ");
}

document.getElementById("verificar").addEventListener("click", ()=>{
    let posiblesFrases = datos[fraseActualIndex].frase;
    let textoSeleccion = seleccionadas.join(" ");
    let correcto = posiblesFrases.includes(textoSeleccion);

    mostrarMensaje(correcto);

    if(correcto){
        fraseActualIndex++;
        if(fraseActualIndex < datos.length){
            setTimeout(iniciarJuego, 900);
        } else {
            // üéµ Al terminar todo ‚Üí sonido final
            audioYeh.currentTime = 0;
            audioYeh.play();
            setTimeout(()=>{ window.location.href="final.html?origen=juego2"; },1200);
        }
    } else {
        setTimeout(iniciarJuego, 900);
    }
});

// Bot√≥n regresar (vuelve a Relacionar)
document.getElementById("btnRegresar").addEventListener("click", () => {
    window.location.href = "juego.html";
});

function mostrarMensaje(correcto){
    let mensajeDiv = document.getElementById("mensaje");
    mensajeDiv.textContent = correcto ? "¬°Correcto!" : "¬°Intenta de nuevo!";
    mensajeDiv.style.background = correcto ? "#4caf50" : "#e53935";
    mensajeDiv.classList.add("visible");

    // üéµ Sonido + parpadeo
    if(correcto){
        audioCorrecto.currentTime = 0;
        audioCorrecto.play();
        document.body.classList.add("parpadeo-correcto");
        setTimeout(()=>document.body.classList.remove("parpadeo-correcto"), 500);
    } else {
        audioError.currentTime = 0;
        audioError.play();
        document.body.classList.add("parpadeo-error");
        setTimeout(()=>document.body.classList.remove("parpadeo-error"), 500);
    }

    setTimeout(()=>mensajeDiv.classList.remove("visible"), 1000);
}

iniciarJuego();
</script>
</body>
</html>

