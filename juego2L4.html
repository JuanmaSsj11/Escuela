<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ordena las palabras - Lección 4</title>
<link rel="stylesheet" href="estilos.css">
<style>
/* Parpadeos suaves */
body.parpadeo-correcto {
  animation: flash-verde 0.5s;
}
body.parpadeo-error {
  animation: flash-rojo 0.5s;
}
@keyframes flash-verde {
  0% { background-color: rgba(0, 255, 0, 0.2); }
  100% { background-color: transparent; }
}
@keyframes flash-rojo {
  0% { background-color: rgba(255, 0, 0, 0.2); }
  100% { background-color: transparent; }
}
</style>
</head>
<body>

<header>
    <button id="btnRegresar" class="btn-regresar">⬅ Regresar</button>
    <h1>Visualiza, Lee y Ordena - Lección 4</h1>
    <p class="autores">Autor: Mtro. Felipe Cruz Suastegi - Jefe del Sector IV Educación Primaria<br>
    Co-autor: Juan Manuel Ontiveros Domínguez</p>
</header>

<!-- Audios globales -->
<audio id="audio-error" src="audios/error.mp3"></audio>
<audio id="audio-correcto" src="audios/correcto.mp3"></audio>
<audio id="audio-yeh" src="audios/yeh.mp3"></audio>

<!-- Contenedor del juego -->
<div class="juego2">
    <div id="imagenFrase"></div>
    <div id="fraseSeleccionada"></div>
    <div id="palabras"></div>
    <button id="verificar">Verificar</button>
</div>

<div id="mensaje"></div>

<script>
// Datos de la Lección 4
const datos = [
  {img: "iguana.png", frase: "La iguana de Isabel subió al árbol", audio: "iguana.mp3"},
  {img: "agua_jamaica.png", frase: "El agua de jamaica es roja", audio: "agua_jamaica.mp3"},
  {img: "kiwi.png", frase: "Un kilo de kiwi para comer ensalada", audio: "kiwi.mp3"},
  {img: "luna.png", frase: "Lola mira la luna en el cielo oscuro", audio: "luna.mp3"},
  {img: "manzana_roja.png", frase: "La manzana de Memo es roja", audio: "manzana_roja.mp3"}
];

let fraseActualIndex = 0;
let seleccionadas = [];

// Audios globales
const audioError = document.getElementById("audio-error");
const audioCorrecto = document.getElementById("audio-correcto");
const audioYeh = document.getElementById("audio-yeh");

function iniciarJuego() {
    seleccionadas = [];
    document.getElementById("palabras").innerHTML = "";
    document.getElementById("fraseSeleccionada").textContent = "";

    let datosActuales = datos[fraseActualIndex];

    // Imagen arriba
    let imagenDiv = document.getElementById("imagenFrase");
    imagenDiv.innerHTML = `<img src="imagenes/${datosActuales.img}" alt="Imagen frase" class="imagenFrase">`;

    // Indicador
    document.getElementById("fraseSeleccionada").textContent = "Selecciona las palabras en orden:";

    // Palabras desordenadas
    let palabras = datosActuales.frase.split(" ");
    let palabrasDesordenadas = [...palabras].sort(()=>Math.random()-0.5);

    palabrasDesordenadas.forEach(palabra=>{
        let btn = document.createElement("button");
        btn.className = "palabra";
        btn.textContent = palabra;

        btn.addEventListener("click", () => {
            if(btn.classList.contains("seleccionada")){
                btn.classList.remove("seleccionada");
                seleccionadas = seleccionadas.filter(p => p !== palabra);
            } else {
                btn.classList.add("seleccionada");
                seleccionadas.push(palabra);
            }
            actualizarFraseSeleccionada();
        });

        document.getElementById("palabras").appendChild(btn);
    });
}

function actualizarFraseSeleccionada(){
    document.getElementById("fraseSeleccionada").textContent = seleccionadas.join(" ");
}

document.getElementById("verificar").addEventListener("click", ()=>{
    let fraseCorrecta = datos[fraseActualIndex].frase;
    let textoSeleccion = seleccionadas.join(" ");
    let correcto = (textoSeleccion === fraseCorrecta);

    mostrarMensaje(correcto);

    if(correcto){
        // Reproduce el audio de la frase correcta
        let audioFrase = new Audio("audios/" + datos[fraseActualIndex].audio);
        audioFrase.play();

        fraseActualIndex++;
        if(fraseActualIndex < datos.length){
            setTimeout(iniciarJuego, 1500);
        } else {
            audioYeh.currentTime = 0;
            audioYeh.play();
            setTimeout(()=>{ window.location.href="final.html?origen=juego2L4"; },1500);
        }
    } else {
        setTimeout(iniciarJuego, 1200);
    }
});

// Botón regresar (vuelve a juego1L4)
document.getElementById("btnRegresar").addEventListener("click", () => {
    window.location.href = "juego1L4.html";
});

function mostrarMensaje(correcto){
    let mensajeDiv = document.getElementById("mensaje");
    mensajeDiv.textContent = correcto ? "¡Correcto!" : "¡Intenta de nuevo!";
    mensajeDiv.style.background = correcto ? "#4caf50" : "#e53935";
    mensajeDiv.classList.add("visible");

    // Sonido + parpadeo
    if(correcto){
        audioCorrecto.currentTime = 0;
        audioCorrecto.play();
        document.body.classList.add("parpadeo-correcto");
        setTimeout(()=>document.body.classList.remove("parpadeo-correcto"), 500);
    } else {
        audioError.currentTime = 0;
        audioError.play();
        document.body.classList.add("parpadeo-error");
        setTimeout(()=>document.body.classList.remove("parpadeo-error"), 500);
    }

    setTimeout(()=>mensajeDiv.classList.remove("visible"), 1000);
}

iniciarJuego();
</script>
</body>
</html>
