<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ordena las palabras - Lecci√≥n 3</title>
<link rel="stylesheet" href="estilos.css">
<style>
/* Parpadeos suaves */
body.parpadeo-correcto {
  animation: flash-verde 0.5s;
}
body.parpadeo-error {
  animation: flash-rojo 0.5s;
}
@keyframes flash-verde {
  0% { background-color: rgba(0, 255, 0, 0.2); }
  100% { background-color: transparent; }
}
@keyframes flash-rojo {
  0% { background-color: rgba(255, 0, 0, 0.2); }
  100% { background-color: transparent; }
}

/* Pantalla final */
#pantallaFinal {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(255, 255, 255, 0.95);
  display: none;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
  z-index: 999;
}
#pantallaFinal.visible {
  display: flex;
}
#pantallaFinal h2 {
  font-size: 2em;
  color: #213448;
  margin-bottom: 20px;
}
#pantallaFinal button {
  margin: 10px;
  padding: 12px 25px;
  border-radius: 12px;
  border: none;
  background: #FFB433;
  color: #213448;
  font-weight: bold;
  font-size: 18px;
  cursor: pointer;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  transition: all 0.3s;
}
#pantallaFinal button:hover {
  background: #FFA500;
  transform: scale(1.05);
}

.imagenFrase {
  width: 200px;
  height: auto;
  cursor: pointer;
  transition: transform 0.2s;
}
.imagenFrase:hover {
  transform: scale(1.05);
}
</style>
</head>
<body>

<header>
    <button id="btnRegresar" class="btn-regresar">‚¨Ö Regresar</button>
    <h1>Visualiza, Lee y Ordena - Lecci√≥n 3</h1>
    <p class="autores">Autor: Mtro. Felipe Cruz Suastegi - Jefe del Sector IV Educaci√≥n Primaria<br>
    Co-autor: Juan Manuel Ontiveros Dom√≠nguez</p>
</header>

<!-- Audios globales -->
<audio id="audio-error" src="audios/error.mp3"></audio>
<audio id="audio-correcto" src="audios/correcto.mp3"></audio>
<audio id="audio-yeh" src="audios/yeh.mp3"></audio>

<!-- Contenedor del juego -->
<div class="juego2">
    <div id="imagenFrase"></div>
    <div id="fraseSeleccionada"></div>
    <div id="palabras"></div>
    <button id="verificar">Verificar</button>
</div>

<div id="mensaje"></div>

<!-- Pantalla final -->
<div id="pantallaFinal">
  <h2>üéâ ¬°Excelente trabajo! üéâ</h2>
  <p>Has completado todas las frases.</p>
  <div>
    <button onclick="jugarDeNuevo()">üîÅ Jugar de nuevo</button>
    <button onclick="continuar()">‚û° Continuar</button>
  </div>
</div>

<script>
const datos = [
  {img: "burro.png", frase: "Benito busca a su burro bronco", audio: "burro.mp3"},
  {img: "queso_fresco.png", frase: "Cecilia come queso fresco", audio: "queso_fresco.mp3"},
  {img: "nina_sin_diente.png", frase: "Se cay√≥ el diente de Daniela", audio: "nina_sin_diente.mp3"},
  {img: "gato.png", frase: "El gato Goyo ma√∫lla en el tejado", audio: "gato.mp3"},
  {img: "hormiga.png", frase: "La hormiga lleva comida a su hogar", audio: "hormiga.mp3"}
];

let fraseActualIndex = 0;
let seleccionadas = [];

// üéµ Audios globales
const audioError = document.getElementById("audio-error");
const audioCorrecto = document.getElementById("audio-correcto");
const audioYeh = document.getElementById("audio-yeh");

function iniciarJuego() {
    seleccionadas = [];
    document.getElementById("palabras").innerHTML = "";
    document.getElementById("fraseSeleccionada").textContent = "";

    let datosActuales = datos[fraseActualIndex];

    // Imagen arriba (clicable para reproducir audio)
    let imagenDiv = document.getElementById("imagenFrase");
    imagenDiv.innerHTML = `<img src="imagenes/${datosActuales.img}" alt="Imagen frase" class="imagenFrase" id="imgActual">`;

    // Reproduce audio al dar clic en la imagen
    const img = document.getElementById("imgActual");
    img.addEventListener("click", () => {
      let audioFrase = new Audio("audios/" + datosActuales.audio);
      audioFrase.play();
    });

    document.getElementById("fraseSeleccionada").textContent = "Selecciona las palabras en orden:";

    // Palabras desordenadas
    let palabras = datosActuales.frase.split(" ");
    let palabrasDesordenadas = [...palabras].sort(()=>Math.random()-0.5);

    palabrasDesordenadas.forEach(palabra=>{
        let btn = document.createElement("button");
        btn.className = "palabra";
        btn.textContent = palabra;

        btn.addEventListener("click", () => {
            if(btn.classList.contains("seleccionada")){
                btn.classList.remove("seleccionada");
                seleccionadas = seleccionadas.filter(p => p !== palabra);
            } else {
                btn.classList.add("seleccionada");
                seleccionadas.push(palabra);
            }
            actualizarFraseSeleccionada();
        });

        document.getElementById("palabras").appendChild(btn);
    });
}

function actualizarFraseSeleccionada(){
    document.getElementById("fraseSeleccionada").textContent = seleccionadas.join(" ");
}

document.getElementById("verificar").addEventListener("click", ()=>{
    let fraseCorrecta = datos[fraseActualIndex].frase;
    let textoSeleccion = seleccionadas.join(" ");
    let correcto = (textoSeleccion === fraseCorrecta);

    mostrarMensaje(correcto);

    if(correcto){
        fraseActualIndex++;
        if(fraseActualIndex < datos.length){
            setTimeout(iniciarJuego, 1500);
        } else {
            // Pantalla final visible
            setTimeout(()=>{
              audioYeh.currentTime = 0;
              audioYeh.play();
              document.getElementById("pantallaFinal").classList.add("visible");
            }, 1200);
        }
    } else {
        setTimeout(iniciarJuego, 1200);
    }
});

// Bot√≥n regresar (vuelve a juego1L3)
document.getElementById("btnRegresar").addEventListener("click", () => {
    window.location.href = "juego1L3.html";
});

function mostrarMensaje(correcto){
    let mensajeDiv = document.getElementById("mensaje");
    mensajeDiv.textContent = correcto ? "¬°Correcto!" : "¬°Intenta de nuevo!";
    mensajeDiv.style.background = correcto ? "#4caf50" : "#e53935";
    mensajeDiv.classList.add("visible");

    // üéµ Sonido + parpadeo
    if(correcto){
        audioCorrecto.currentTime = 0;
        audioCorrecto.play();
        document.body.classList.add("parpadeo-correcto");
        setTimeout(()=>document.body.classList.remove("parpadeo-correcto"), 500);
    } else {
        audioError.currentTime = 0;
        audioError.play();
        document.body.classList.add("parpadeo-error");
        setTimeout(()=>document.body.classList.remove("parpadeo-error"), 500);
    }

    setTimeout(()=>mensajeDiv.classList.remove("visible"), 1000);
}

// Pantalla final opciones
function jugarDeNuevo(){
  window.location.href = "juego2L3.html";
}
function continuar(){
  window.location.href = "game3.html";
}

iniciarJuego();
</script>
</body>
</html>
